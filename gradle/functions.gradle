import static java.lang.Character.isWhitespace
import static java.lang.Character.toTitleCase
import static java.lang.Long.toHexString

import java.time.Instant

ext {
	bumpVersion = { index = releaseTypeOrdinal() ->
		def nextVersion = nextVersion index
		def propertiesFile = file 'gradle.properties'

		propertiesFile.text = propertiesFile.text.replaceAll "mod_version(\\s*=\\s*)${mod_version}", "mod_version\$1${nextVersion}"

		return nextVersion
	}

	fabricApiModule = { module, version = fabric_version ->
		return fabricApi.module(module, version)
	}
	
	nextVersion = { index = releaseTypeOrdinal() ->
		def split = mod_version.split '\\.'

		split[index] = split[index] as Integer + 1

		for (i in index + 1 ..< split.length) {
			split[i] = 0
		}

		return split.join('.')
	}

	releaseTypeOrdinal = { ->
		switch (System.env.RELEASE_TYPE ?: 'alpha') {
		case 'release':
			return 0
		case 'beta':
			return 1
		default:
			return 2
		}
	}

	titleCased = { text ->
		def textTitleCased = new char[text.size()]
		def titleCase = true

		for (i in 0 ..< text.size()) {
			char ch = text.charAt i

			if (!isWhitespace(ch)) {
				if (titleCase) {
					ch = toTitleCase ch
					titleCase = false
				}

				textTitleCased[i] = ch
			} else {
				titleCase = true
			}
		}

		return String.valueOf(textTitleCased)
	}
}
