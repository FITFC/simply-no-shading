curseforge {
	if (System.env.CURSEFORGE_API_KEY) {
		apiKey = System.env.CURSEFORGE_API_KEY
	}

	project {
		id = '550997'
		changelog = createChangelog()
		changelogType = 'markdown'
		releaseType = System.env.RELEASE_TYPE ?: 'alpha'

		addGameVersion 'Fabric'
		addGameVersion minecraft_version

		mainArtifact remapJar, {
			displayName = createVersionName()

			relations {
				optionalDependency 'fabric-api'
				optionalDependency 'modmenu'
				optionalDependency 'irisshaders'
				optionalDependency 'sodium'
			}
		}

		afterEvaluate {
			uploadTask.dependsOn 'remapJar'
		}
	}

	options {
		forgeGradleIntegration = false
	}
}

modrinth {
	token = System.env.MODRINTH_TOKEN
	versionType = System.env.RELEASE_TYPE ?: 'alpha'
	projectId = '9gx5Xvc5'
	versionNumber = nextVersion()
	versionName = createVersionName()
	changelog = createChangelog()
	uploadFile = remapJar
	gameVersions = [ minecraft_version ]
	loaders = [ 'fabric' ]
}

def createChangelog() {
	return System.env.CHANGELOG?.strip() ?: 'No changelog provided'
}

def createVersionName() {
	return "${titleCased System.env.RELEASE_TYPE ?: 'alpha'} ${nextVersion()} for Minecraft ${minecraft_version}"
}
